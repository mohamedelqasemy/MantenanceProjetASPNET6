@model IEnumerable<MantenanceProjetASPNET6.Models.SearchModel3>

@using NonFactors.Mvc.Grid;
@{
    ViewData["Title"] = "ListPresent4eme";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<head>
    <link href="~/css/mvc-grid/mvc-grid.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<div>
    <!-- Tableau Grid MVC -->
    @(
        Html.Grid(Model).Build(columns =>
        {
            columns.Add(model => model.Cne).Titled("CNE").Css("text-center");
            columns.Add(model => model.Cin).Titled("CNI").Css("text-center");
            columns.Add(model => model.Nom).Titled("Nom").Css("text-center");
            columns.Add(model => model.Prenom).Titled("Prenom").Css("text-center");
            columns.Add(model => model.Matricule).Titled("Matricule").Css("text-center");
            // Ajouter une colonne pour appliquer une classe CSS conditionnelle
            columns.Add(model => model.Adress).Titled("Adress");
        })
        .Empty("No data found")
        .Pageable(pager =>
        {
            pager.RowsPerPage = 6;
        })
        .Filterable()
        .Sortable()
        .Css("table table-striped table-bordered my-grid")
        )
</div>

<!-- Bouton pour exporter en Excel -->
<!--
<div class="text-center mt-3">
    <button class="btn btn-success" onclick="exportTableToExcel('my-grid')">Exporter en Excel</button>
</div>
-->

<script src="~/js/mvc-grid/mvc-grid.js"></script>
<script>
    // Initialiser la grille MVC
    document.querySelectorAll(".mvc-grid").forEach(element => new MvcGrid(element));

    // Fonction pour exporter la grille en Excel
    function exportTableToExcel(className) {
        var dataType = 'application/vnd.ms-excel;charset=utf-8'; // Encodage UTF-8 pour les caractères spéciaux
        var table = document.querySelector(`.${className}`);

        if (!table) {
            alert("Table non trouvée !");
            return;
        }

        // Cloner la table pour modification sans affecter l'originale
        var tableClone = table.cloneNode(true);

        // Supprimer les lignes contenant les filtres
        tableClone.querySelectorAll('.mvc-grid-row-filter').forEach(row => row.remove());

        // Convertir la table en une chaîne HTML
        var tableHTML = tableClone.outerHTML.replace(/ /g, '%20');

        // Nom du fichier Excel
        var filename = "ListeCandidats_Recherche_4A.xls";

        // Création d'un lien de téléchargement
        var downloadLink = document.createElement("a");
        document.body.appendChild(downloadLink);

        // Blob pour les navigateurs modernes
        if (window.Blob) {
            var blob = new Blob(['\ufeff', tableHTML], { type: dataType });
            var url = URL.createObjectURL(blob);
            downloadLink.href = url;
            downloadLink.download = filename;
            downloadLink.click();

            // Libérer l'URL après téléchargement
            URL.revokeObjectURL(url);
        } else {
            // Pour les anciens navigateurs (ex : IE)
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
            downloadLink.download = filename;
            downloadLink.click();
        }

        // Supprimer le lien après utilisation
        document.body.removeChild(downloadLink);
    }
</script>
