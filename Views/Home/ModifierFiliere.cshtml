@model MantenanceProjetASPNET6.ViewModels.FiliereModel
@{
    ViewData["Title"] = "ModifierFiliere";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

<div class="page-content-wrapper-inner" style="font-family:'Arial Rounded MT';">
    <div class="content-viewport">
        <div class="container-fluid">
            @if (ViewBag.IsBeforeCurrentDate == true)
            {
                <!-- USER DATA-->
                <div class="user-data m-b-40">

                    <h2 class="title-3 mb-4 mt-4 text-center text-warning font-weight-bold">
                        <i class="mdi mdi-function link-icon mr-4"></i>
                        Modification de la Filière Choisie
                    </h2>

                    <hr class="col-md-8 offset-md-2 mb-5" />

                    @using (Html.BeginForm("ModifierFiliere", "Home", FormMethod.Post))
                    {
                        <div class="row d-flex justify-content-center m-b-30">
                            <div class="col-md-11">
                            <div class="form-horizontal">
                                <div class="alert alert-success">
                                    <span>Vous êtes en @Model.niveau ème année. Filière actuelle : <span id="filiereNom"></span> </span>
                                </div>
                            </div>

                            @if (TempData["filiere"] != null)
                            {
                                <div class="form-group">
                                    <div class="alert alert-success">
                                        <span>@TempData["filiere"]</span>
                                    </div>
                                </div>
                            }

                            <div class="form-horizontal">
                                <div class="form-group offset-4">
                                    <br />

                                    <div class="form-group" id="filiereOptions">
                                        <!-- Les options seront insérées dynamiquement ici -->
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-offset-2 col-md-10 d-flex justify-content-center">
                                        <input type="submit" value="Modifier la filière" class="btn btn-primary btn-rounded px-4 mt-5 mx-2" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }

            </div>
            }
            else
            {
                <div class="form-group">
                    <div class="alert alert-danger ml-3 mr-3">
                        <span>Vous ne pouvez pas modifier vos donnes!</span>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<script>
    // La fonction qui met à jour les options de filière
    function updateFiliereOptions(niveau, filiereId) {
        var filiereOptionsDiv = document.getElementById("filiereOptions");
        filiereOptionsDiv.innerHTML = ''; // Vider les options précédentes

        var filieres = [];
        if (niveau == "3") {
            filieres = [
                { value: 9, label: "Génie mécatronique et systèmes intelligents" },
                { value: 7, label: "Génie réseaux et télécommunications" },
                { value: 12, label: "Génie informatique et intelligence artificielle" },
                { value: 8, label: "Génie aéronautique et technologie de l'espace" },
                { value: 6, label: "Génie industriel" },
                { value: 5, label: "Génie des procédés et matériaux avancés" }
            ];
        } else if (niveau == "4") {
            filieres = [
                { value: 7, label: "Génie réseaux et télécommunications" },
                { value: 11, label: "Génie informatique" },
                { value: 10, label: "Ingénierie des données et intelligence artificielle" },
                { value: 6, label: "Génie industriel" },
                { value: 8, label: "Génie aéronautique et technologie de l'espace" },
                { value: 5, label: "Génie des procédés et matériaux avancés" }
            ];
        }

        // Ajouter les options de filière dynamiquement
        filieres.forEach(function(filiere) {
            var radioDiv = document.createElement("div");
            radioDiv.classList.add("custom-control", "custom-radio", "mt-2");

            var input = document.createElement("input");
            input.type = "radio";
            input.classList.add("custom-control-input");
            input.id = "filiere" + filiere.value;
            input.name = "ID";
            input.value = filiere.value;
            if (filiere.value === filiereId) {
                input.checked = true; // Coche l'option de la filière sélectionnée par défaut
            }

            var label = document.createElement("label");
            label.classList.add("custom-control-label");
            label.setAttribute("for", "filiere" + filiere.value);
            label.textContent = filiere.label;

            radioDiv.appendChild(input);
            radioDiv.appendChild(label);

            filiereOptionsDiv.appendChild(radioDiv);
        });
    }

    // La fonction pour récupérer le nom de la filière selon l'ID
    function getFiliereNameById(id) {
        var filieres = {
            9: "Génie mécatronique et systèmes intelligents",
            7: "Génie réseaux et télécommunications",
            12: "Génie informatique et intelligence artificielle",
            8: "Génie aéronautique et technologie de l'espace",
            6: "Génie industriel",
            5: "Génie des procédés et matériaux avancés",
            11: "Génie informatique",
            10: "Ingénierie des données et intelligence artificielle"
        };

        return filieres[id] || "Filière non trouvée"; // Retourner un nom ou un message si l'ID est invalide
    }

    document.addEventListener("DOMContentLoaded", function() {
        // Passer le niveau et l'ID de la filière du modèle à la fonction
        var filiereId = @Model.ID; // ID de la filière sélectionnée
        var niveau = @Model.niveau; // Niveau de la filière

        // Afficher le nom de la filière
        var filiereNom = getFiliereNameById(filiereId);
        document.getElementById("filiereNom").textContent = filiereNom;

        // Mettre à jour les options de filière en fonction du niveau et de l'ID de la filière
        updateFiliereOptions(niveau, filiereId);
    });
</script>
